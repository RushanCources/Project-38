{% extends 'base.html' %}
{% load static %}

{% block head %}
<link rel="stylesheet" href="{% static 'css/dec/dec.css' %}">
<title>Объявления</title>
{% endblock head %}
{% block content %}

<!-- <main class="main"> -->

    <div class="main-nav">
        <form method="get" action="{% url 'search' %}">
            <div class="search">
                <input value="{{ search_value }}" name='q' class="search-input" type="text" placeholder="Поиск...">
                <button class="search-button"></button>
            </div>
        </form>
    </div>

    <div class="FSL" id="FSL"> <!-- FSL==Facking Scroll List-->
        {% for announcement in page_announcements %}
        <div class="flex" id="flex{{ announcement.id }}">
            <p class="cap">{{ announcement.title }}</p>
            <button class="btn btn-dec"></button>
            <p class="text">{{ announcement.body }}</p>
            <div class="IB" id="IB"><!--сюды фотку-->

            </div>
            <ul class="dec-list">
                <li class="dec-item"><p class="text">{{ announcement.body }}</p></li>
            </ul>
        </div>
        {% endfor %}
        <!-- <button class="btn bold" type="submit" onclick=""></button>
            <button class="btn italic" type="submit" onclick=""></button>
            <button class="btn italic" type="submit" onclick=""></button>
            <button class="btn italic" type="submit" onclick=""></button> -->
    </div>
    <script>
        $('.btn-dec').on('click', function () {
            let ul = this.parentNode.childNodes[3];
            if ($(ul).hasClass('ul-open')) {
                $(ul).removeClass('ul-open');
            } else {
                $(ul).addClass('ul-open');
            }
        });
    </script>


<button id="load-more-button">Load More</button>

<!-- Почти весь скрипт ниже сделан с помощью ChatGPT потому что я не шарю в джаваскрипте, попровьте если плохо -->
<!-- Все что он делает - реализует функционал страничек объявлений, добавляя кнопку на подгрузку объявлений, если их будет слишком много. По идее можно ничего не трогать, все работает -->

<script>
    $(document).ready(function() {
        var page = 2;  // Start from page 2 since page 1 is already loaded
        var batch_size = 20;  // Match this with the batch size set in the backend

        function checkLoadMoreButtonVisibility() {
            if ($('.flex').length != (page-1) * batch_size) {
                $("#load-more-button").hide();
            } else {
                $("#load-more-button").show();
            }
        }

        checkLoadMoreButtonVisibility();  // Initially check button visibility

        $("#load-more-button").click(function() {
            var query = encodeURIComponent('{{ search_value }}');
            $.get('?q=' + query + '&page=' + page, function(data) {
                var newAnnouncements = $(data).find('.flex');
                if (newAnnouncements.length > 0) {
                    $("#FSL").append(newAnnouncements);
                    page++;
                    checkLoadMoreButtonVisibility();  // Check and update button visibility
                } else {
                    $("#load-more-button").hide();
                }
            });
        });
    });
</script>

<!-- </main> -->
{% endblock content %}